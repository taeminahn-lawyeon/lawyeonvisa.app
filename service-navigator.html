<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Navigator - Lawyeon Visa & Immigration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F5F6F8;
            min-height: 100vh;
            color: #191F28;
        }

        /* Header */
        .header {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #E5E8EB;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #F2F4F6;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #4E5968;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: #E5E8EB;
        }

        .header-title {
            font-size: 18px;
            font-weight: 700;
            color: #191F28;
        }

        /* Main Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 24px 20px 40px;
        }

        /* Progress Bar */
        .progress-section {
            margin-bottom: 32px;
        }

        .progress-text {
            font-size: 14px;
            color: #8B95A1;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .progress-bar {
            height: 4px;
            background: #E5E8EB;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #3182F6;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Question Card */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
        }

        .question-title {
            font-size: 24px;
            font-weight: 800;
            color: #191F28;
            margin-bottom: 8px;
            line-height: 1.4;
            letter-spacing: -0.5px;
        }

        .question-subtitle {
            font-size: 15px;
            color: #8B95A1;
            margin-bottom: 28px;
            line-height: 1.5;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .option-btn {
            background: #F9FAFB;
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
        }

        .option-btn:hover {
            border-color: #3182F6;
            background: #EBF4FF;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(49, 130, 246, 0.12);
        }

        .option-btn:active {
            transform: translateY(0);
        }

        .option-btn .option-title {
            font-size: 16px;
            font-weight: 700;
            color: #191F28;
            line-height: 1.4;
        }

        .option-btn .option-desc {
            font-size: 13px;
            color: #8B95A1;
            line-height: 1.4;
        }

        /* Navigation */
        .nav-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #F2F4F6;
        }

        .nav-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.secondary {
            background: #F2F4F6;
            border: none;
            color: #4E5968;
        }

        .nav-btn.secondary:hover {
            background: #E5E8EB;
        }

        .nav-btn.primary {
            background: #3182F6;
            border: none;
            color: white;
        }

        .nav-btn.primary:hover {
            background: #1B64DA;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Result Card */
        .result-section {
            display: none;
        }

        .result-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .result-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #3182F6 0%, #1B64DA 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 28px;
            color: white;
        }

        .result-title {
            font-size: 22px;
            font-weight: 800;
            color: #191F28;
            margin-bottom: 8px;
        }

        .result-subtitle {
            font-size: 15px;
            color: #8B95A1;
        }

        .recommended-services {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .service-card {
            background: white;
            border: 2px solid #E5E8EB;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.2s;
        }

        .service-card:hover {
            border-color: #3182F6;
            box-shadow: 0 4px 16px rgba(49, 130, 246, 0.12);
        }

        .service-card .service-name {
            font-size: 18px;
            font-weight: 700;
            color: #191F28;
            margin-bottom: 8px;
        }

        .service-card .service-desc {
            font-size: 14px;
            color: #8B95A1;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .service-card .apply-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: #3182F6;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .service-card .apply-btn:hover {
            background: #1B64DA;
        }

        .restart-btn {
            display: block;
            width: 100%;
            padding: 16px;
            margin-top: 24px;
            background: #F2F4F6;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            color: #4E5968;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            background: #E5E8EB;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 20px 16px 32px;
            }

            .question-card {
                padding: 24px 20px;
                border-radius: 16px;
            }

            .question-title {
                font-size: 20px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .option-btn {
                min-height: 76px;
                padding: 16px;
            }

            .option-btn .option-title {
                font-size: 15px;
            }

            .nav-section {
                flex-direction: column-reverse;
                gap: 12px;
            }

            .nav-btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="header-title">Service Navigator</h1>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Progress -->
        <div class="progress-section">
            <div class="progress-text" id="progressText">Step 1 of 4</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 25%"></div>
            </div>
        </div>

        <!-- Question Section -->
        <div class="question-card" id="questionSection">
            <h2 class="question-title" id="questionTitle">What is your current status?</h2>
            <p class="question-subtitle" id="questionSubtitle">Select the option that best describes your situation</p>

            <div class="options-grid" id="optionsGrid">
                <!-- Options will be populated by JavaScript -->
            </div>

            <div class="nav-section">
                <button class="nav-btn secondary" id="prevBtn" onclick="prevStep()" disabled>
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-btn secondary" onclick="restart()">
                    Start Over
                </button>
            </div>
        </div>

        <!-- Result Section -->
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <div class="result-icon">
                    <i class="fas fa-check"></i>
                </div>
                <h2 class="result-title">Recommended Services</h2>
                <p class="result-subtitle">Based on your selections, we recommend:</p>
            </div>

            <div class="recommended-services" id="recommendedServices">
                <!-- Services will be populated by JavaScript -->
            </div>

            <button class="restart-btn" onclick="restart()">
                <i class="fas fa-redo"></i> Start Over
            </button>
        </div>
    </div>

    <script>
        // Decision Tree Data
        const decisionTree = {
            step1: {
                question: "What is your current status?",
                subtitle: "Select the option that best describes your situation",
                options: [
                    { id: "valid_visa", title: "In Korea with Valid Visa", desc: "Currently staying legally" },
                    { id: "overstay", title: "In Korea - Overstaying", desc: "Visa expired or no valid status" },
                    { id: "overseas", title: "Outside Korea", desc: "Planning to visit or move" },
                    { id: "korean", title: "Korean Citizen", desc: "With foreign family members" }
                ]
            },
            step2: {
                valid_visa: {
                    question: "What do you need help with?",
                    subtitle: "Select your primary purpose",
                    options: [
                        { id: "extend", title: "Extend My Visa", desc: "Stay longer with current status" },
                        { id: "change", title: "Change Visa Type", desc: "Switch to different visa category" },
                        { id: "report", title: "Report Changes", desc: "Address, workplace, passport" },
                        { id: "certificate", title: "Get Documents", desc: "Certificates & proof documents" },
                        { id: "permanent", title: "Permanent Residency", desc: "Apply for F-5 visa" },
                        { id: "naturalize", title: "Naturalization", desc: "Become Korean citizen" }
                    ]
                },
                overstay: {
                    question: "What is your situation?",
                    subtitle: "We can help with urgent cases",
                    options: [
                        { id: "voluntary", title: "Voluntary Departure", desc: "Want to leave legally" },
                        { id: "deportation", title: "Deportation Order", desc: "Received removal notice" },
                        { id: "legal_help", title: "Need Legal Advice", desc: "Understand my options" }
                    ]
                },
                overseas: {
                    question: "What is your purpose of visit?",
                    subtitle: "Select your primary reason",
                    options: [
                        { id: "tourism", title: "Tourism / Short Visit", desc: "Less than 90 days" },
                        { id: "work", title: "Employment", desc: "Work in Korea" },
                        { id: "study", title: "Study / Training", desc: "Education purposes" },
                        { id: "business", title: "Business / Investment", desc: "Start or invest in business" },
                        { id: "family", title: "Family / Marriage", desc: "Join family in Korea" }
                    ]
                },
                korean: {
                    question: "Who needs immigration help?",
                    subtitle: "Select your family situation",
                    options: [
                        { id: "spouse_invite", title: "Invite Foreign Spouse", desc: "Marriage visa (F-6)" },
                        { id: "parent_invite", title: "Invite Parents", desc: "Family visitation (F-1)" },
                        { id: "child_invite", title: "Invite Children", desc: "Dependent visa" },
                        { id: "family_naturalize", title: "Family Naturalization", desc: "Help them become Korean" }
                    ]
                }
            },
            step3: {
                // Valid Visa paths
                extend: {
                    question: "What type of visa do you have?",
                    subtitle: "Select your current visa category",
                    options: [
                        { id: "ext_work", title: "Work Visa", desc: "E-1 to E-7, etc." },
                        { id: "ext_study", title: "Student Visa", desc: "D-2, D-4" },
                        { id: "ext_family", title: "Family Visa", desc: "F-1, F-2, F-6" },
                        { id: "ext_other", title: "Other Visa", desc: "D-10, G-1, etc." }
                    ]
                },
                change: {
                    question: "What visa do you want to change to?",
                    subtitle: "Select your target visa type",
                    options: [
                        { id: "chg_work", title: "Work Visa", desc: "Employment-based" },
                        { id: "chg_family", title: "Family Visa", desc: "Marriage, dependent" },
                        { id: "chg_business", title: "Business Visa", desc: "D-8, D-9" },
                        { id: "chg_residence", title: "Long-term Residence", desc: "F-2, F-5" }
                    ]
                },
                report: {
                    question: "What do you need to report?",
                    subtitle: "Select the type of change",
                    options: [
                        { id: "rep_address", title: "Address Change", desc: "Moved to new location" },
                        { id: "rep_workplace", title: "Workplace Change", desc: "New employer or job" },
                        { id: "rep_passport", title: "Passport Update", desc: "New passport issued" },
                        { id: "rep_status", title: "Status Change", desc: "Marriage, divorce, etc." }
                    ]
                },
                certificate: {
                    question: "What document do you need?",
                    subtitle: "Select the certificate type",
                    options: [
                        { id: "cert_alien", title: "Alien Registration", desc: "ID card related" },
                        { id: "cert_entry", title: "Entry/Exit Records", desc: "Travel history" },
                        { id: "cert_status", title: "Status Certificate", desc: "Visa status proof" },
                        { id: "cert_invitation", title: "Invitation Letter", desc: "For family visits" }
                    ]
                },
                permanent: {
                    question: "What is your eligibility basis?",
                    subtitle: "Select your qualification path",
                    options: [
                        { id: "perm_work", title: "Employment-based", desc: "5+ years with work visa" },
                        { id: "perm_marriage", title: "Marriage-based", desc: "Married to Korean" },
                        { id: "perm_invest", title: "Investment-based", desc: "Business investor" },
                        { id: "perm_special", title: "Special Contribution", desc: "Exceptional cases" }
                    ]
                },
                naturalize: {
                    question: "What type of naturalization?",
                    subtitle: "Select your path to citizenship",
                    options: [
                        { id: "nat_general", title: "General Naturalization", desc: "5+ years residence" },
                        { id: "nat_simple", title: "Simplified Naturalization", desc: "Marriage to Korean" },
                        { id: "nat_special", title: "Special Naturalization", desc: "Special contribution" }
                    ]
                },
                // Overstay paths
                voluntary: {
                    question: "How long have you overstayed?",
                    subtitle: "This affects your options",
                    options: [
                        { id: "vol_short", title: "Less than 3 months", desc: "Recent overstay" },
                        { id: "vol_medium", title: "3 months to 1 year", desc: "Moderate period" },
                        { id: "vol_long", title: "Over 1 year", desc: "Extended overstay" }
                    ]
                },
                deportation: {
                    question: "What stage are you at?",
                    subtitle: "Select your current situation",
                    options: [
                        { id: "dep_notice", title: "Received Notice", desc: "Just got the order" },
                        { id: "dep_detention", title: "In Detention", desc: "At immigration facility" },
                        { id: "dep_appeal", title: "Want to Appeal", desc: "Challenge the decision" }
                    ]
                },
                legal_help: {
                    question: "What kind of legal help?",
                    subtitle: "Select your concern",
                    options: [
                        { id: "legal_risk", title: "Risk Assessment", desc: "Understand my situation" },
                        { id: "legal_options", title: "Legal Options", desc: "What can I do" },
                        { id: "legal_represent", title: "Legal Representation", desc: "Need a lawyer" }
                    ]
                },
                // Overseas paths
                tourism: {
                    question: "What's your nationality?",
                    subtitle: "Visa requirements vary by country",
                    options: [
                        { id: "tour_exempt", title: "Visa-Exempt Country", desc: "US, EU, Japan, etc." },
                        { id: "tour_required", title: "Visa Required", desc: "Need K-ETA or visa" }
                    ]
                },
                work: {
                    question: "What type of work?",
                    subtitle: "Select your employment type",
                    options: [
                        { id: "work_pro", title: "Professional/Skilled", desc: "E-7, E-1~E-5" },
                        { id: "work_eps", title: "EPS Worker", desc: "E-9 manufacturing" },
                        { id: "work_teach", title: "Teaching", desc: "E-2 language teaching" },
                        { id: "work_entertain", title: "Entertainment", desc: "E-6 arts/sports" }
                    ]
                },
                study: {
                    question: "What type of study?",
                    subtitle: "Select your program",
                    options: [
                        { id: "study_degree", title: "Degree Program", desc: "D-2 university" },
                        { id: "study_language", title: "Language Course", desc: "D-4 Korean study" },
                        { id: "study_exchange", title: "Exchange Program", desc: "Short-term study" }
                    ]
                },
                business: {
                    question: "What's your business plan?",
                    subtitle: "Select your investment type",
                    options: [
                        { id: "biz_startup", title: "Start a Business", desc: "D-8 corporate investor" },
                        { id: "biz_invest", title: "Investment Only", desc: "D-8 investor" },
                        { id: "biz_trade", title: "Trade Activities", desc: "D-9 trade manager" }
                    ]
                },
                family: {
                    question: "What's your relationship?",
                    subtitle: "Select family type",
                    options: [
                        { id: "fam_spouse", title: "Marry Korean Citizen", desc: "F-6 marriage visa" },
                        { id: "fam_join", title: "Join Family Member", desc: "F-1 family visit" },
                        { id: "fam_ethnic", title: "Ethnic Korean", desc: "F-4 overseas Korean" }
                    ]
                },
                // Korean citizen paths
                spouse_invite: {
                    question: "Where is your spouse now?",
                    subtitle: "Select current location",
                    options: [
                        { id: "sp_overseas", title: "Still Overseas", desc: "Need to apply from abroad" },
                        { id: "sp_korea", title: "Already in Korea", desc: "Status change needed" }
                    ]
                },
                parent_invite: {
                    question: "What type of visit?",
                    subtitle: "Select visit duration",
                    options: [
                        { id: "par_short", title: "Short Visit", desc: "C-3 visitor visa" },
                        { id: "par_long", title: "Long-term Stay", desc: "F-1 family visa" }
                    ]
                },
                child_invite: {
                    question: "Child's age and status?",
                    subtitle: "Select applicable situation",
                    options: [
                        { id: "child_minor", title: "Minor Child", desc: "Under 18 years old" },
                        { id: "child_adult", title: "Adult Child", desc: "18 or older" }
                    ]
                },
                family_naturalize: {
                    question: "Family member's status?",
                    subtitle: "Current immigration status",
                    options: [
                        { id: "fnat_resident", title: "Already Residing", desc: "Has F-2 or F-5" },
                        { id: "fnat_spouse", title: "Marriage Visa", desc: "Has F-6" },
                        { id: "fnat_other", title: "Other Visa", desc: "Different visa type" }
                    ]
                }
            }
        };

        // Service Recommendations - using actual service IDs from service-apply-general.html
        const serviceRecommendations = {
            // Work visa extensions
            ext_work: [
                { name: "E-7 Visa Extension", desc: "Extend your E-7 professional work visa before expiration.", code: "e7-extension" }
            ],
            ext_study: [
                { name: "D-2, D-4 Visa Extension", desc: "Extend your D-2 or D-4 student visa. Requires enrollment proof.", code: "d2-d4-extension" }
            ],
            ext_family: [
                { name: "F-6 Visa Extension", desc: "Extend your F-6 marriage visa.", code: "f6-extension" },
                { name: "F-2 Residence Extension", desc: "Extend your F-2 residence visa.", code: "f2-extension" }
            ],
            ext_other: [
                { name: "D-10 Visa Extension", desc: "Extend your D-10 job seeker visa.", code: "d10-extension" }
            ],
            // Visa changes
            chg_work: [
                { name: "E-7 Professional Visa Change", desc: "Change your current visa to E-7 professional employment visa.", code: "e7-change" },
                { name: "E-7-4 Skilled Worker Visa", desc: "E-9/H-2 skilled worker transition.", code: "e7-4-change" }
            ],
            chg_family: [
                { name: "F-6 Marriage Immigration", desc: "Change to F-6 marriage visa.", code: "f6-change" },
                { name: "F-3 Dependent Family Visa", desc: "Spouse/child accompanying visa.", code: "f3-change" },
                { name: "F-1 Family Visit Visa", desc: "Relative long-term stay visa.", code: "f1-change" }
            ],
            chg_business: [
                { name: "D-8-1 Corporate Investment", desc: "Corporate establishment visa.", code: "d8-1-change" },
                { name: "D-9-1 Trade Business", desc: "Trading business visa.", code: "d9-1-change" }
            ],
            chg_residence: [
                { name: "F-2-7 Points-based Residence", desc: "Outstanding talent residence visa.", code: "f2-7-change" },
                { name: "F-5 Permanent Residence", desc: "Korea permanent residency.", code: "f5-change" }
            ],
            // Reports
            rep_address: [
                { name: "Address Change Report", desc: "Report your new address after moving.", code: "address-change" }
            ],
            rep_workplace: [
                { name: "Workplace Change Report", desc: "Report new employer or workplace change.", code: "workplace-change-report" },
                { name: "Workplace Change Permit", desc: "Pre-approval for job transfer.", code: "workplace-change-permit" }
            ],
            rep_passport: [
                { name: "Passport/Info Change", desc: "Update your alien registration with new passport info.", code: "passport-change" }
            ],
            rep_status: [
                { name: "Employment Info Update", desc: "Report workplace/salary changes.", code: "employment-info-change" }
            ],
            // Certificates
            cert_alien: [
                { name: "Alien Registration", desc: "Required within 90 days of entry.", code: "arc-registration" },
                { name: "ARC Reissue", desc: "Lost/damaged card replacement.", code: "arc-reissue" }
            ],
            cert_entry: [
                { name: "Entry/Exit Certificate", desc: "Official record of your travel history.", code: "cert-entry-exit" }
            ],
            cert_status: [
                { name: "ARC Certificate", desc: "Proof of your registration status.", code: "cert-arc" }
            ],
            cert_invitation: [
                { name: "Family Invitation Visa", desc: "Overseas family invitation service.", code: "family-invite" }
            ],
            // Permanent residence
            perm_work: [
                { name: "F-5 Permanent Residence", desc: "Apply for permanent residence based on employment history.", code: "f5-change" }
            ],
            perm_marriage: [
                { name: "F-5 Permanent Residence", desc: "Apply for permanent residence as spouse of Korean.", code: "f5-change" }
            ],
            perm_invest: [
                { name: "F-5 Permanent Residence", desc: "Apply for permanent residence as business investor.", code: "f5-change" }
            ],
            perm_special: [
                { name: "F-5 Permanent Residence", desc: "Apply based on special contribution or merit.", code: "f5-change" }
            ],
            // Naturalization
            nat_general: [
                { name: "Naturalization Application", desc: "Become Korean citizen through standard process (5+ years).", code: "naturalization" }
            ],
            nat_simple: [
                { name: "Naturalization Application", desc: "Faster path for spouses of Korean citizens.", code: "naturalization" }
            ],
            nat_special: [
                { name: "Naturalization Application", desc: "Naturalization for those with special contributions.", code: "naturalization" }
            ],
            // Overstay - these go to emergency legal consultation
            vol_short: [
                { name: "Immigration Dispute Resolution", desc: "Consult with immigration attorneys about your situation.", code: "emergency-legal" }
            ],
            vol_medium: [
                { name: "Immigration Dispute Resolution", desc: "Navigate the departure process with legal support.", code: "emergency-legal" }
            ],
            vol_long: [
                { name: "Immigration Dispute Resolution", desc: "Legal representation for complex overstay cases.", code: "emergency-legal" }
            ],
            dep_notice: [
                { name: "Immigration Dispute Resolution", desc: "Challenge deportation order with legal representation.", code: "emergency-legal" }
            ],
            dep_detention: [
                { name: "Immigration Dispute Resolution", desc: "Legal assistance for release from detention.", code: "emergency-legal" }
            ],
            dep_appeal: [
                { name: "Immigration Dispute Resolution", desc: "File administrative appeal against deportation.", code: "emergency-legal" }
            ],
            legal_risk: [
                { name: "Visa Pre-diagnosis", desc: "Professional evaluation of your immigration situation.", code: "visa-prediagnosis" }
            ],
            legal_options: [
                { name: "Visa Pre-diagnosis", desc: "Understand all available legal pathways.", code: "visa-prediagnosis" }
            ],
            legal_represent: [
                { name: "Immigration Dispute Resolution", desc: "Full legal representation by licensed attorney.", code: "emergency-legal" }
            ],
            // Tourism - consultation
            tour_exempt: [
                { name: "Visa Pre-diagnosis", desc: "Verify your visa-exempt entry eligibility.", code: "visa-prediagnosis" }
            ],
            tour_required: [
                { name: "Visa Pre-diagnosis", desc: "Get guidance on tourist visa application.", code: "visa-prediagnosis" }
            ],
            // Work visa from overseas
            work_pro: [
                { name: "E-7 Professional Visa Change", desc: "Skilled worker visa for professionals.", code: "e7-change" },
                { name: "E-1~E-6 Professional Change", desc: "Professor, researcher, or technical specialist visa.", code: "e1-e6-change" }
            ],
            work_eps: [
                { name: "E-9 Workplace Change", desc: "E-9 employment permit system support.", code: "e9-workplace-change" }
            ],
            work_teach: [
                { name: "E-1~E-6 Professional Change", desc: "Teaching and education visa.", code: "e1-e6-change" }
            ],
            work_entertain: [
                { name: "E-1~E-6 Professional Change", desc: "Arts, sports, and entertainment visa.", code: "e1-e6-change" }
            ],
            // Study
            study_degree: [
                { name: "D-4â†’D-2 Student Visa Change", desc: "University degree program visa.", code: "d4-to-d2-change" }
            ],
            study_language: [
                { name: "D-2, D-4 Visa Extension", desc: "Korean language course visa support.", code: "d2-d4-extension" }
            ],
            study_exchange: [
                { name: "D-2, D-4 Visa Extension", desc: "Short-term academic exchange visa.", code: "d2-d4-extension" }
            ],
            // Business
            biz_startup: [
                { name: "D-8-4 Tech Startup Visa", desc: "Student entrepreneur visa.", code: "d8-4-change" },
                { name: "D-8-1 Corporate Investment", desc: "Corporate investor visa for starting business.", code: "d8-1-change" }
            ],
            biz_invest: [
                { name: "D-8-2 Venture Investment", desc: "Venture company investment visa.", code: "d8-2-change" },
                { name: "D-8-3 Individual Investment", desc: "Sole proprietor investment visa.", code: "d8-3-change" }
            ],
            biz_trade: [
                { name: "D-9-1 Trade Business", desc: "Trade and business management visa.", code: "d9-1-change" }
            ],
            // Family overseas
            fam_spouse: [
                { name: "F-6 Marriage Immigration", desc: "Visa for spouse of Korean citizen.", code: "f6-change" }
            ],
            fam_join: [
                { name: "F-1 Family Visit Visa", desc: "Family accompaniment or visit visa.", code: "f1-change" }
            ],
            fam_ethnic: [
                { name: "F-4 Overseas Korean Visa", desc: "Visa for ethnic Koreans abroad.", code: "f4-change" }
            ],
            // Korean inviting spouse
            sp_overseas: [
                { name: "Family Invitation Visa", desc: "Complete F-6 visa application from abroad.", code: "family-invite" }
            ],
            sp_korea: [
                { name: "F-6 Marriage Immigration", desc: "Change existing visa to F-6 marriage visa.", code: "f6-change" }
            ],
            // Parent invitation
            par_short: [
                { name: "Family Invitation Visa", desc: "Short-term visitor visa for parents.", code: "family-invite" }
            ],
            par_long: [
                { name: "F-1 Family Visit Visa", desc: "Long-term family visa for parents.", code: "f1-change" }
            ],
            // Child invitation
            child_minor: [
                { name: "Child Birth Visa Grant", desc: "Dependent visa for minor children.", code: "visa-grant-child" }
            ],
            child_adult: [
                { name: "F-1 Family Visit Visa", desc: "F-1 visa for adult children.", code: "f1-change" }
            ],
            // Family naturalization
            fnat_resident: [
                { name: "Naturalization Application", desc: "Naturalization for permanent residents.", code: "naturalization" }
            ],
            fnat_spouse: [
                { name: "Naturalization Application", desc: "Simplified naturalization for F-6 holders.", code: "naturalization" }
            ],
            fnat_other: [
                { name: "Visa Pre-diagnosis", desc: "Assess eligibility and plan naturalization.", code: "visa-prediagnosis" }
            ]
        };

        // State
        let currentStep = 1;
        let selections = [];
        let history = [];

        // Initialize
        function init() {
            renderStep();
        }

        // Render current step
        function renderStep() {
            const questionSection = document.getElementById('questionSection');
            const resultSection = document.getElementById('resultSection');

            questionSection.classList.remove('hidden');
            resultSection.style.display = 'none';

            let stepData;

            if (currentStep === 1) {
                stepData = decisionTree.step1;
            } else if (currentStep === 2) {
                const prevSelection = selections[0];
                stepData = decisionTree.step2[prevSelection];
            } else if (currentStep === 3) {
                const prevSelection = selections[1];
                stepData = decisionTree.step3[prevSelection];
            }

            if (!stepData) {
                showResults();
                return;
            }

            // Update progress
            document.getElementById('progressText').textContent = `Step ${currentStep} of 4`;
            document.getElementById('progressFill').style.width = `${currentStep * 25}%`;

            // Update question
            document.getElementById('questionTitle').textContent = stepData.question;
            document.getElementById('questionSubtitle').textContent = stepData.subtitle;

            // Render options
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = stepData.options.map(opt => `
                <button class="option-btn" onclick="selectOption('${opt.id}')">
                    <div class="option-title">${opt.title}</div>
                    ${opt.desc ? `<div class="option-desc">${opt.desc}</div>` : ''}
                </button>
            `).join('');

            // Update back button
            document.getElementById('prevBtn').disabled = currentStep === 1;
        }

        // Select option
        function selectOption(optionId) {
            history.push({ step: currentStep, selections: [...selections] });
            selections[currentStep - 1] = optionId;
            currentStep++;

            if (currentStep > 3 || !getNextStepData()) {
                showResults();
            } else {
                renderStep();
            }
        }

        // Get next step data
        function getNextStepData() {
            if (currentStep === 2) {
                return decisionTree.step2[selections[0]];
            } else if (currentStep === 3) {
                return decisionTree.step3[selections[1]];
            }
            return null;
        }

        // Show results
        function showResults() {
            document.getElementById('questionSection').classList.add('hidden');
            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';

            // Update progress
            document.getElementById('progressText').textContent = 'Complete';
            document.getElementById('progressFill').style.width = '100%';

            // Get recommendations based on last selection
            const lastSelection = selections[selections.length - 1];
            const services = serviceRecommendations[lastSelection] || [
                { name: "General Consultation", desc: "Speak with our immigration experts to find the right solution.", code: "general-consult" }
            ];

            // Render services
            const servicesContainer = document.getElementById('recommendedServices');
            servicesContainer.innerHTML = services.map(svc => `
                <div class="service-card">
                    <div class="service-name">${svc.name}</div>
                    <div class="service-desc">${svc.desc}</div>
                    <button class="apply-btn" onclick="applyService('${svc.code}')">
                        Apply Now <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `).join('');
        }

        // Apply for service
        function applyService(code) {
            window.location.href = `service-apply-general.html?service=${code}`;
        }

        // Previous step
        function prevStep() {
            if (history.length > 0) {
                const prev = history.pop();
                currentStep = prev.step;
                selections = prev.selections;
                renderStep();
            }
        }

        // Go back (header button)
        function goBack() {
            if (currentStep > 1) {
                prevStep();
            } else {
                window.location.href = 'index-test.html';
            }
        }

        // Restart
        function restart() {
            currentStep = 1;
            selections = [];
            history = [];
            renderStep();
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
