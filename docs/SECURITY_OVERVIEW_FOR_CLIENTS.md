# 법무법인 로연 비자 서비스 — 보안 및 개인정보 보호 개요

> **최종 수정일**: 2026-02-09
> **문의**: 법무법인 로연 기술팀

---

## 1. 인프라 구성

서비스는 다음 구성 요소로 운영됩니다.

| 구성 요소 | 제공사 | 역할 | 보안 인증 |
|-----------|--------|------|-----------|
| 데이터베이스·인증·스토리지 | **Supabase** | PostgreSQL DB, 사용자 인증, 파일 저장 | SOC 2 Type II (AWS 인프라 기반) |
| 클라우드 인프라 | **AWS** | Supabase가 사용하는 서버·네트워크·물리 보안 | ISO 27001, SOC 2 Type II |
| 결제 처리 | **Toss Payments** | 카드·계좌이체 등 결제 수단 처리 | PCI DSS Level 1 |
| 소셜 로그인 | **Google OAuth 2.0** | Google 계정 기반 인증 | ISO 27001 |
| 웹 호스팅 | **GitHub Pages** | 정적 웹사이트 배포 | SOC 2 |

Supabase는 오픈소스 BaaS(Backend as a Service)로, 내부적으로 PostgreSQL, GoTrue(인증), S3 호환 스토리지를 사용합니다. 자체 서버를 직접 운영하는 것이 아니라 Supabase가 관리하는 AWS 인프라 위에서 동작하므로, AWS의 물리 보안·네트워크 보안 인증이 그대로 적용됩니다.

---

## 2. 접근 통제 — Row Level Security (RLS)

Supabase의 핵심 보안 기능은 **Row Level Security(RLS)**입니다.

RLS란 데이터베이스 테이블의 **각 행(row)마다** 접근 권한을 설정하는 PostgreSQL 내장 기능입니다. 애플리케이션 코드가 아니라 **데이터베이스 엔진 자체에서** 접근을 차단하기 때문에, API를 우회하더라도 권한 밖의 데이터를 조회할 수 없습니다.

### 현재 적용 현황

| 테이블 | 일반 사용자 | 기관 담당자 | 관리자(변호사) | 최고 관리자 |
|--------|------------|------------|--------------|------------|
| profiles (회원 정보) | 본인만 조회·수정 | — | — | 전체 조회 |
| threads (상담 내역) | 본인 건만 | 소속 기관 건만 | 담당 건 조회 | 전체 조회 |
| messages (메시지) | 본인 스레드 내만 | 소속 기관 건만 | 담당 건 조회 | 전체 조회 |
| payments (결제) | 본인만 | — | — | 전체 조회 |
| applications (신청서) | 본인만 | — | — | 전체 조회 |

**RLS가 의미하는 것**: 사용자 A가 API 요청을 보내면, DB 엔진이 해당 요청의 인증 토큰(JWT)에서 사용자 ID를 추출하고, 테이블의 `user_id` 컬럼과 대조합니다. 일치하지 않는 행은 쿼리 결과에서 아예 제외됩니다. 이 검증은 DB 레벨에서 실행되므로 애플리케이션 코드의 버그와 무관하게 동작합니다.

---

## 3. 인증 체계

| 방식 | 구현 | 비고 |
|------|------|------|
| Google OAuth 2.0 | Supabase Auth (GoTrue) | Google 측에서 인증 처리, 우리 서버에 비밀번호 미저장 |
| 이메일/비밀번호 | Supabase Auth | bcrypt 해싱 후 저장 (단방향 — 원문 복원 불가) |
| 세션 관리 | JWT (JSON Web Token) | 토큰 자동 만료, 로그아웃 시 클라이언트 측 즉시 폐기 |
| 관리자 인증 | admins 테이블 역할 검증 | super_admin / admin 역할 분리, RLS 정책에서 참조 |

JWT는 Supabase가 발급하며, 모든 API 요청 시 Bearer Token으로 전송됩니다. 서버(Edge Function)는 이 토큰을 검증한 후에만 요청을 처리합니다.

---

## 4. 데이터 암호화

### 4-1. 전송 구간 (In Transit)

모든 클라이언트-서버 통신은 **TLS 1.2 이상**으로 암호화됩니다. HTTP 요청은 HTTPS로 강제 리다이렉트됩니다.

### 4-2. 저장 구간 (At Rest)

- **데이터베이스**: AWS 관리형 암호화(AES-256) 적용 — Supabase 기본 설정
- **파일 스토리지**: 클라이언트 측 E2E 암호화 적용 (아래 상세)

### 4-3. 파일 E2E 암호화 (End-to-End Encryption)

여권, 신분증 등 민감 문서는 **업로드 전 사용자 브라우저에서 암호화**됩니다.

| 항목 | 사양 |
|------|------|
| 알고리즘 | AES-256-GCM (Web Crypto API) |
| 키 생성 | 사용자별 고유 키, 브라우저의 `crypto.subtle.generateKey()` |
| 키 저장 | 사용자 기기의 IndexedDB에만 보관 — 서버에 전송되지 않음 |
| IV (초기화 벡터) | 파일마다 12바이트 랜덤 생성 |
| 파일 접근 | 서명된 URL(Signed URL)로만 다운로드 가능, 만료 시간 설정 |

이 구조에서 서버(Supabase Storage)에는 암호화된 바이너리만 저장됩니다. 복호화 키가 서버에 존재하지 않으므로, DB가 유출되더라도 파일 내용은 해독할 수 없습니다.

---

## 5. 결제 보안

카드번호 등 결제 민감정보는 **우리 서버를 경유하지 않습니다**.

| 항목 | 내용 |
|------|------|
| PG사 | Toss Payments (PCI DSS Level 1 인증) |
| 처리 방식 | 클라이언트 → Toss Payments 직접 통신으로 카드정보 처리 |
| 서버 저장 항목 | 거래 ID(paymentKey), 주문 ID, 금액, 결제 상태만 기록 |
| 중복 결제 방지 | Idempotency Key 기반 — 동일 거래키 재사용 시 자동 거부 |
| 금액 검증 | 서버 측 Edge Function에서 요청 금액과 승인 금액 재검증 |
| CORS 제한 | `lawyeonvisa.app` 도메인에서만 결제 확인 API 호출 허용 |
| 감사 로그 | 모든 결제 시도(성공·실패)를 `payment_logs` 테이블에 기록 |

---

## 6. 감사 로그 및 모니터링

| 로그 종류 | 기록 항목 | 보관 기간 |
|-----------|-----------|-----------|
| 보안 감사 로그 | 로그인·로그아웃·권한 변경·비정상 접근 시도 | 5년 |
| 결제 로그 | 결제 요청·승인·실패·환불 전체 이력 | 5년 |
| 파일 접근 로그 | 문서 업로드·다운로드·열람 기록 (사용자, IP, 시간) | 1년 |
| 알림 발송 로그 | WhatsApp·Telegram·LINE 등 발송 상태 | 3년 |
| Rate Limiting | IP/사용자 단위 요청 횟수 제한 (60초당 10회) | 실시간 (1시간 TTL) |

---

## 7. 법적 준수 사항

### 적용 법률 및 보관 기간

| 법률 | 대상 데이터 | 의무 보관 기간 |
|------|------------|---------------|
| 개인정보보호법 | 전체 개인정보 | 수집 목적 달성 시까지 (탈퇴 시 삭제) |
| 변호사법 제26조 | 법률 상담·수임 기록 | 5년 |
| 전자상거래법 | 결제·계약 기록 | 5년 |
| 전자상거래법 | 소비자 분쟁 기록 | 3년 |
| 통신비밀보호법 | IP 접속 기록 | 3개월 |

### 정보주체 권리

개인정보보호법에 따라 사용자는 다음을 요청할 수 있습니다:
- 본인 개인정보 열람
- 오류 정정
- 삭제 요청 (법적 보관 의무 기간 제외)
- 처리 정지 요청
- 데이터 이동(포터빌리티)

---

## 8. 제3자 데이터 위탁

개인정보 처리방침 제5조에 따라, 다음 업체에 데이터 처리를 위탁하고 있습니다.

| 수탁자 | 소재지 | 위탁 업무 | DPA 체결 |
|--------|--------|-----------|----------|
| Supabase Inc. | USA | 데이터베이스·인증·스토리지 호스팅 | O |
| Google LLC | USA | OAuth 인증 제공 | O |
| GitHub Inc. | USA | 웹사이트 호스팅 | O |
| Toss Payments | KR | 결제 처리 | O |

---

## 9. 자주 받는 질문

**Q. Supabase를 쓰면 데이터가 미국에 저장되나요?**

Supabase는 AWS 인프라를 사용하며 리전 선택이 가능합니다. 저장 위치와 무관하게, 전송 시 TLS 암호화가 적용되고, 저장 시 AWS 관리형 AES-256 암호화가 적용됩니다. 또한 DPA(데이터 처리 계약)를 통해 한국 개인정보보호법 수준의 보호 의무를 계약상 보장받고 있습니다.

**Q. DB 유출 시 개인정보가 그대로 노출되나요?**

세 가지 층위의 보호가 있습니다:
1. 비밀번호는 bcrypt로 해싱되어 저장 — 원문 복원 불가
2. 민감 문서(여권 등)는 AES-256-GCM으로 E2E 암호화 — 복호화 키가 서버에 없음
3. DB 자체가 AWS 관리형 암호화 적용

**Q. 관리자가 퇴사하면 어떻게 되나요?**

`admins` 테이블에서 해당 계정을 제거하면 즉시 관리자 권한이 소멸합니다. RLS 정책이 매 쿼리마다 `admins` 테이블을 참조하여 권한을 확인하므로, 계정 제거 즉시 모든 데이터 접근이 차단됩니다.

**Q. 카드번호가 서버에 저장되나요?**

저장되지 않습니다. 카드 정보는 PCI DSS 인증을 받은 Toss Payments가 직접 처리하며, 우리 서버에는 거래 ID·금액·결제 상태만 기록됩니다.

---

## 10. 보안 아키텍처 요약

```
사용자 브라우저
├── Google OAuth 2.0 인증
├── 비밀번호 → bcrypt 해싱 후 전송
├── 파일 → AES-256-GCM 암호화 후 업로드
└── 결제 → Toss Payments 직접 통신 (서버 미경유)
      │
      │  TLS 1.2+ (HTTPS)
      ▼
Supabase (AWS)
├── Auth (GoTrue) ─── JWT 발급·검증
├── PostgreSQL ─────── RLS 적용 (테이블별 행 단위 접근 통제)
├── Storage (S3) ──── 암호화된 파일 저장 (Signed URL 접근)
├── Edge Functions ── 결제 확인·알림 발송 (서버 사이드 로직)
└── 감사 로그 ──────── 보안·결제·파일접근·알림 기록
```

---

## 관련 문서

| 문서 | 위치 |
|------|------|
| 개인정보 처리방침 (전문) | [privacy-policy.html](../privacy-policy.html) |
| 이용약관 | [terms-of-service.html](../terms-of-service.html) |
| RLS 정책 SQL | [sql/PRODUCTION_SETUP_COMPLETE.sql](../sql/PRODUCTION_SETUP_COMPLETE.sql) |
| 보안 강화 SQL | [sql/SECURITY_ENHANCEMENT.sql](../sql/SECURITY_ENHANCEMENT.sql) |
