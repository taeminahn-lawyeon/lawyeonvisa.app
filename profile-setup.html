<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="profile.title">ê¸°ë³¸ ì‚¬í•­ ì œì¶œ</title> - <span data-i18n="site.name">ë²•ë¬´ë²•ì¸ ë¡œì—° ì¶œì…êµ­ì´ë¯¼ì§€ì›ì„¼í„°</span>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #F9FAFB;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 100%);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 24px;
            text-align: center;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            border-bottom: 3px solid #3182F6;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 900;
            color: white;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }

        .header p {
            color: rgba(255,255,255,0.8);
            font-size: 16px;
            font-weight: 500;
        }

        /* ì§„í–‰ ë‹¨ê³„ í‘œì‹œ */
        .progress-bar {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.04);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 4px;
            background: #E5E7EB;
            z-index: 1;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            height: 4px;
            background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%);
            transition: width 0.3s ease;
            z-index: 2;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            flex: 1;
        }

        .step-circle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            color: #9CA3AF;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .step.completed .step-circle {
            background: linear-gradient(135deg, #00C73C 0%, #00A82F 100%);
            color: white;
        }

        .step-label {
            font-size: 14px;
            font-weight: 700;
            color: #9CA3AF;
            text-align: center;
        }

        .step.active .step-label {
            color: #2563EB;
        }

        .step.completed .step-label {
            color: #00C73C;
        }

        /* í¼ ì¹´ë“œ */
        .form-card {
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.04);
            margin-bottom: 24px;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 24px;
            font-weight: 900;
            color: #191F28;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .section-title .icon {
            font-size: 28px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 10px;
        }

        .required {
            color: #EF4444;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3182F6;
            background: #F0F9FF;
        }

        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 48px;
        }

        /* ì£¼ì†Œ ê²€ìƒ‰ */
        .address-search {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .address-search input {
            flex: 1;
        }

        .address-search button {
            padding: 16px 24px;
            background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .address-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* íŒŒì¼ ì—…ë¡œë“œ */
        .file-upload-area {
            border: 3px dashed #E5E7EB;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #F9FAFB;
        }

        .file-upload-area:hover {
            border-color: #3182F6;
            background: #F0F9FF;
        }

        .file-upload-area.dragover {
            border-color: #3182F6;
            background: #EBF4FF;
        }

        .file-upload-area .icon {
            font-size: 48px;
            color: #9CA3AF;
            margin-bottom: 16px;
        }

        .file-upload-area p {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .file-upload-area small {
            font-size: 14px;
            color: #9CA3AF;
        }

        .file-preview {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .file-item {
            position: relative;
            display: inline-block;
        }

        .file-item img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid #E5E7EB;
        }

        .file-item .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 28px;
            height: 28px;
            background: #EF4444;
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
        }

        /* ì„œëª… íŒ¨ë“œ */
        .signature-pad {
            border: 3px solid #E5E7EB;
            border-radius: 16px;
            background: white;
            cursor: crosshair;
            display: block !important;
            width: 100% !important;
            max-width: 100%;
            height: 300px !important;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .signature-controls {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 12px;
        }

        .signature-controls button {
            padding: 12px 20px;
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .signature-controls button:hover {
            border-color: #3182F6;
            color: #3182F6;
        }

        /* ì œì¶œ ë²„íŠ¼ */
        .submit-section {
            margin-top: 40px;
            text-align: center;
        }

        .submit-btn {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
        }

        .submit-btn:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
            transform: none;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 0;
            }

            .header {
                padding: 32px 24px;
                border-radius: 20px;
            }

            .header h1 {
                font-size: 26px;
            }

            .header p {
                font-size: 14px;
            }

            .form-card {
                padding: 32px 24px;
                border-radius: 20px;
            }

            .section-title {
                font-size: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .progress-steps {
                flex-wrap: wrap;
            }

            .step {
                margin-bottom: 16px;
            }

            .step-circle {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .step-label {
                font-size: 12px;
            }

            .address-search {
                flex-direction: column;
            }

            .address-search button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header" style="position: relative;">
            <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
            <button id="backButton" style="position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.95); border: 2px solid rgba(255,255,255,1); color: #2563EB; padding: 12px 24px; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                <i class="fas fa-arrow-left"></i>
                <span data-i18n="common.back">ë’¤ë¡œê°€ê¸°</span>
            </button>
            
            <h1 data-i18n="profile.title">ê¸°ë³¸ ì‚¬í•­ ì œì¶œ</h1>
            <p data-i18n="profile.subtitle">ëª¨ë“  ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ í•„ìš”í•œ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        </div>

        <!-- ì§„í–‰ ë‹¨ê³„ -->
        <div class="progress-bar">
            <div class="progress-steps">
                <div class="progress-line" id="progressLine" style="width: 0%;"></div>
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label" data-i18n="profile.step1">ê¸°ë³¸ì •ë³´</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label" data-i18n="profile.step2">ì²´ë¥˜ì •ë³´</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label" data-i18n="profile.step3">ì„œë¥˜ë“±ë¡</div>
                </div>
            </div>
        </div>

        <!-- í¼ -->
        <form id="profileForm">
            <!-- Step 1: ê¸°ë³¸ì •ë³´ -->
            <div class="form-card" id="step1">
                <div class="form-section">
                    <div class="section-title">
                        <span class="icon">ğŸ‘¤</span>
                        <span data-i18n="profile.basicInfo">ê¸°ë³¸ ì •ë³´</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span data-i18n="profile.lastName">ì˜ë¬¸ ì„± (Last Name)</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="text" name="lastName" required data-i18n-placeholder="profile.lastNamePlaceholder" placeholder="ì˜ˆ) KIM">
                        </div>
                        <div class="form-group">
                            <label><span data-i18n="profile.firstName">ì˜ë¬¸ ì´ë¦„ (First Name)</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="text" name="firstName" required data-i18n-placeholder="profile.firstNamePlaceholder" placeholder="ì˜ˆ) MINHO">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span data-i18n="profile.birthDate">ìƒë…„ì›”ì¼</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="date" name="birthDate" value="2000-01-01" required>
                        </div>
                        <div class="form-group">
                            <label><span data-i18n="profile.gender">ì„±ë³„</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <select name="gender" required>
                                <option value="" data-i18n="profile.selectGender">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="male" data-i18n="profile.male">ë‚¨ì„±</option>
                                <option value="female" data-i18n="profile.female">ì—¬ì„±</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span data-i18n="profile.email">ì´ë©”ì¼</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="email" name="email" required data-i18n-placeholder="profile.emailPlaceholder" placeholder="example@email.com">
                        </div>
                        <div class="form-group">
                            <label><span data-i18n="profile.phone">ì „í™”ë²ˆí˜¸</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="tel" name="phone" required data-i18n-placeholder="profile.phonePlaceholder" placeholder="010-0000-0000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span data-i18n="profile.messenger">ì„ í˜¸ ë©”ì‹ ì €</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <select name="preferredMessenger" required>
                                <option value="" data-i18n="profile.selectMessenger">ë©”ì‹ ì €ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="whatsapp">WhatsApp (ì™“ì¸ ì•±)</option>
                                <option value="wechat">WeChat (ìœ„ì±—)</option>
                                <option value="telegram">Telegram (í…”ë ˆê·¸ë¨)</option>
                                <option value="kakaotalk">KakaoTalk (ì¹´ì¹´ì˜¤í†¡)</option>
                                <option value="line">LINE (ë¼ì¸)</option>
                                <option value="zalo">Zalo (ì˜ë¡œ)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span data-i18n="profile.messengerId">ë©”ì‹ ì € ID/ì „í™”ë²ˆí˜¸</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="text" name="messengerId" required data-i18n-placeholder="profile.messengerPlaceholder" placeholder="ë©”ì‹ ì € ID ë˜ëŠ” ì „í™”ë²ˆí˜¸">
                        </div>
                    </div>

                    <div class="form-group">
                        <label><span data-i18n="profile.nationality">êµ­ì </span> <span class="required" data-i18n="profile.required">*</span></label>
                        <select name="nationality" required>
                            <option value="" data-i18n="profile.selectNationality">êµ­ì ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <optgroup label="ì•„ì‹œì•„">
                                <option value="CN">ì¤‘êµ­</option>
                                <option value="VN">ë² íŠ¸ë‚¨</option>
                                <option value="UZ">ìš°ì¦ˆë² í‚¤ìŠ¤íƒ„</option>
                                <option value="TH">íƒœêµ­</option>
                                <option value="MN">ëª½ê³¨</option>
                                <option value="ID">ì¸ë„ë„¤ì‹œì•„</option>
                                <option value="PH">í•„ë¦¬í•€</option>
                                <option value="KH">ìº„ë³´ë””ì•„</option>
                                <option value="NP">ë„¤íŒ”</option>
                                <option value="MM">ë¯¸ì–€ë§ˆ</option>
                                <option value="PK">íŒŒí‚¤ìŠ¤íƒ„</option>
                                <option value="JP">ì¼ë³¸</option>
                                <option value="BD">ë°©ê¸€ë¼ë°ì‹œ</option>
                                <option value="IN">ì¸ë„</option>
                                <option value="LK">ìŠ¤ë¦¬ë‘ì¹´</option>
                            </optgroup>
                            <optgroup label="ë¶ë¯¸">
                                <option value="US">ë¯¸êµ­</option>
                                <option value="CA">ìºë‚˜ë‹¤</option>
                            </optgroup>
                            <optgroup label="ìœ ëŸ½">
                                <option value="RU">ëŸ¬ì‹œì•„</option>
                                <option value="GB">ì˜êµ­</option>
                                <option value="FR">í”„ë‘ìŠ¤</option>
                                <option value="DE">ë…ì¼</option>
                                <option value="IT">ì´íƒˆë¦¬ì•„</option>
                                <option value="ES">ìŠ¤í˜ì¸</option>
                            </optgroup>
                            <optgroup label="ì˜¤ì„¸ì•„ë‹ˆì•„">
                                <option value="AU">í˜¸ì£¼</option>
                                <option value="NZ">ë‰´ì§ˆëœë“œ</option>
                            </optgroup>
                            <optgroup label="ê¸°íƒ€">
                                <option value="OTHER">ê¸°íƒ€</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="button" class="submit-btn" onclick="goToStep(2)">
                        <span data-i18n="profile.next">ë‹¤ìŒ ë‹¨ê³„</span> <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: ì²´ë¥˜ì •ë³´ -->
            <div class="form-card" id="step2" style="display: none;">
                <div class="form-section">
                    <div class="section-title">
                        <span class="icon">ğŸ“‹</span>
                        <span data-i18n="profile.residenceInfo">ì²´ë¥˜ ì •ë³´</span>
                    </div>

                    <div class="form-group">
                        <label><span data-i18n="profile.visaType">ì²´ë¥˜ìê²©</span> <span class="required" data-i18n="profile.required">*</span></label>
                        <select name="visaType" required>
                            <option value="" data-i18n="profile.selectVisa">ì²´ë¥˜ìê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <optgroup label="ë‹¨ê¸°ì²´ë¥˜ (C)">
                                <option value="C-1">C-1 ì¼ì‹œì·¨ì¬</option>
                                <option value="C-3">C-3 ë‹¨ê¸°ë°©ë¬¸</option>
                                <option value="C-4">C-4 ë‹¨ê¸°ì·¨ì—…</option>
                            </optgroup>
                            <optgroup label="ìœ í•™/ì—°ìˆ˜ (D)">
                                <option value="D-1">D-1 ë¬¸í™”ì˜ˆìˆ </option>
                                <option value="D-2">D-2 ìœ í•™</option>
                                <option value="D-3">D-3 ê¸°ìˆ ì—°ìˆ˜</option>
                                <option value="D-4">D-4 ì¼ë°˜ì—°ìˆ˜</option>
                                <option value="D-5">D-5 ì·¨ì¬</option>
                                <option value="D-6">D-6 ì¢…êµ</option>
                                <option value="D-7">D-7 ì£¼ì¬</option>
                                <option value="D-8">D-8 ê¸°ì—…íˆ¬ì</option>
                                <option value="D-9">D-9 ë¬´ì—­ê²½ì˜</option>
                                <option value="D-10">D-10 êµ¬ì§</option>
                            </optgroup>
                            <optgroup label="ì·¨ì—… (E)">
                                <option value="E-1">E-1 êµìˆ˜</option>
                                <option value="E-2">E-2 íšŒí™”ì§€ë„</option>
                                <option value="E-3">E-3 ì—°êµ¬</option>
                                <option value="E-4">E-4 ê¸°ìˆ ì§€ë„</option>
                                <option value="E-5">E-5 ì „ë¬¸ì§ì—…</option>
                                <option value="E-6">E-6 ì˜ˆìˆ í¥í–‰</option>
                                <option value="E-7">E-7 íŠ¹ì •í™œë™</option>
                                <option value="E-9">E-9 ë¹„ì „ë¬¸ì·¨ì—…</option>
                                <option value="E-10">E-10 ì„ ì›ì·¨ì—…</option>
                            </optgroup>
                            <optgroup label="ë°©ë¬¸ì·¨ì—… (H)">
                                <option value="H-1">H-1 ê´€ê´‘ì·¨ì—…</option>
                                <option value="H-2">H-2 ë°©ë¬¸ì·¨ì—…</option>
                            </optgroup>
                            <optgroup label="ì¬ì™¸ë™í¬/ì˜ì£¼ (F)">
                                <option value="F-1">F-1 ë°©ë¬¸ë™ê±°</option>
                                <option value="F-2">F-2 ê±°ì£¼</option>
                                <option value="F-4">F-4 ì¬ì™¸ë™í¬</option>
                                <option value="F-5">F-5 ì˜ì£¼</option>
                                <option value="F-6">F-6 ê²°í˜¼ì´ë¯¼</option>
                            </optgroup>
                            <optgroup label="ê¸°íƒ€">
                                <option value="G-1">G-1 ê¸°íƒ€</option>
                                <option value="A-1">A-1 ì™¸êµ</option>
                                <option value="A-2">A-2 ê³µë¬´</option>
                                <option value="A-3">A-3 í˜‘ì •</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span data-i18n="profile.visaExpiry">ì²´ë¥˜ê¸°ê°„ ë§Œë£Œì¼</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="date" name="stayExpiry" required>
                        </div>
                        <div class="form-group">
                            <label><span data-i18n="profile.foreignerNumber">ì™¸êµ­ì¸ë“±ë¡ë²ˆí˜¸</span> <span class="required" data-i18n="profile.required">*</span></label>
                            <input type="text" name="foreignerNumber" required data-i18n-placeholder="profile.foreignerPlaceholder" placeholder="000000-0000000">
                        </div>
                    </div>

                    <div class="form-group">
                        <label><span data-i18n="profile.address">êµ­ë‚´ ê±°ì£¼ì§€</span> <span class="required" data-i18n="profile.required">*</span></label>
                        <div class="address-search">
                            <input type="text" id="postcode" name="postcode" data-i18n-placeholder="profile.postcodePlaceholder" placeholder="ìš°í¸ë²ˆí˜¸" readonly required>
                            <button type="button" onclick="execDaumPostcode()">
                                <i class="fas fa-search"></i> <span data-i18n="profile.searchAddress">ì£¼ì†Œ ê²€ìƒ‰</span>
                            </button>
                        </div>
                        <input type="text" id="address" name="address" data-i18n-placeholder="profile.addressPlaceholder" placeholder="ì£¼ì†Œ" readonly required style="margin-bottom: 12px;">
                        <input type="text" name="detailAddress" data-i18n-placeholder="profile.addressDetailPlaceholder" placeholder="ìƒì„¸ì£¼ì†Œ (ë™/í˜¸ìˆ˜)" required>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="button" class="submit-btn" style="background: #9CA3AF; margin-bottom: 12px;" onclick="goToStep(1)">
                        <i class="fas fa-arrow-left"></i> <span data-i18n="profile.prev">ì´ì „ ë‹¨ê³„</span>
                    </button>
                    <button type="button" class="submit-btn" onclick="goToStep(3)">
                        <span data-i18n="profile.next">ë‹¤ìŒ ë‹¨ê³„</span> <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: ì„œë¥˜ë“±ë¡ -->
            <div class="form-card" id="step3" style="display: none;">
                <div class="form-section">
                    <div class="section-title">
                        <span class="icon">ğŸ“„</span>
                        <span data-i18n="profile.documents">í•„ìˆ˜ ì„œë¥˜ ë“±ë¡</span>
                    </div>

                    <div class="form-group">
                        <label>ì™¸êµ­ì¸ë“±ë¡ì¦ (ì•ë©´) <span class="required">*</span></label>
                        <div class="file-upload-area" onclick="document.getElementById('arcFront').click()" 
                             ondrop="handleDrop(event, 'arcFront')" 
                             ondragover="handleDragOver(event)"
                             ondragleave="handleDragLeave(event)">
                            <div class="icon">ğŸ“¸</div>
                            <p>í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ & ë“œë¡­</p>
                            <small>JPG, PNG íŒŒì¼ (ìµœëŒ€ 10MB)</small>
                        </div>
                        <input type="file" id="arcFront" name="arcFront" accept="image/*" style="display: none;" onchange="previewFile(this, 'arcFrontPreview')" required>
                        <div class="file-preview" id="arcFrontPreview"></div>
                    </div>

                    <div class="form-group">
                        <label>ì™¸êµ­ì¸ë“±ë¡ì¦ (ë’·ë©´) <span class="required">*</span></label>
                        <div class="file-upload-area" onclick="document.getElementById('arcBack').click()"
                             ondrop="handleDrop(event, 'arcBack')" 
                             ondragover="handleDragOver(event)"
                             ondragleave="handleDragLeave(event)">
                            <div class="icon">ğŸ“¸</div>
                            <p>í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ & ë“œë¡­</p>
                            <small>JPG, PNG íŒŒì¼ (ìµœëŒ€ 10MB)</small>
                        </div>
                        <input type="file" id="arcBack" name="arcBack" accept="image/*" capture="environment" style="display: none;" onchange="previewFile(this, 'arcBackPreview')" required>
                        <div class="file-preview" id="arcBackPreview"></div>
                    </div>

                    <div class="form-group">
                        <label>ì—¬ê¶Œ (ì‚¬ì§„ë©´) <span class="required">*</span></label>
                        <div class="file-upload-area" onclick="document.getElementById('passport').click()"
                             ondrop="handleDrop(event, 'passport')" 
                             ondragover="handleDragOver(event)"
                             ondragleave="handleDragLeave(event)">
                            <div class="icon">ğŸ“¸</div>
                            <p>í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ & ë“œë¡­</p>
                            <small>JPG, PNG íŒŒì¼ (ìµœëŒ€ 10MB)</small>
                        </div>
                        <input type="file" id="passport" name="passport" accept="image/*" style="display: none;" onchange="previewFile(this, 'passportPreview')" required>
                        <div class="file-preview" id="passportPreview"></div>
                    </div>

                    <div class="form-group">
                        <label>ì„œëª… (í†µí•©ì‹ ì²­ì„œ ì œì¶œìš©) <span class="required">*</span></label>
                        <p style="font-size: 14px; color: #6B7280; margin-bottom: 12px;">
                            ì•„ë˜ ì„œëª…ë€ì— ë³¸ì¸ì˜ ì„œëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. ì‘ì„±í•˜ì‹  ì„œëª…ì€ ì¶œì…êµ­ í†µí•©ì‹ ì²­ì„œì— ì‚¬ìš©ë©ë‹ˆë‹¤.
                        </p>
                        <canvas id="signaturePad" class="signature-pad"></canvas>
                        <div class="signature-controls">
                            <button type="button" onclick="clearSignature()">
                                <i class="fas fa-redo"></i> ë‹¤ì‹œ ì‘ì„±
                            </button>
                        </div>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="button" class="submit-btn" style="background: #9CA3AF; margin-bottom: 12px;" onclick="goToStep(2)">
                        <i class="fas fa-arrow-left"></i> ì´ì „ ë‹¨ê³„
                    </button>
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-check-circle"></i> ì œì¶œ ì™„ë£Œ
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Signature Pad ì´ˆê¸°í™”
        let signaturePad = null;

        function initSignaturePad() {
            try {
                const canvas = document.getElementById('signaturePad');
                
                if (!canvas) {
                    console.error('Canvas element not found');
                    return;
                }

                // SignaturePad ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof SignaturePad === 'undefined') {
                    console.error('SignaturePad library not loaded');
                    return;
                }

                // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë¶€ëª¨ ìš”ì†Œì— ë§ì¶¤
                const parent = canvas.parentElement;
                const rect = parent.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 300;

                // SignaturePad ì´ˆê¸°í™”
                signaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)',
                    minWidth: 1,
                    maxWidth: 3
                });

                console.log('âœ“ SignaturePad initialized successfully');
                
            } catch (error) {
                console.error('Error initializing SignaturePad:', error);
            }
        }

        function clearSignature() {
            if (signaturePad) {
                signaturePad.clear();
                console.log('Signature cleared');
            } else {
                console.error('signaturePad not initialized');
            }
        }

        // ë‹¨ê³„ ì´ë™
        function goToStep(step) {
            // í˜„ì¬ ë‹¨ê³„ ìœ íš¨ì„± ê²€ì‚¬
            if (step > 1) {
                const currentStep = step - 1;
                const currentForm = document.getElementById('step' + currentStep);
                const inputs = currentForm.querySelectorAll('input[required], select[required]');
                
                let isValid = true;
                inputs.forEach(input => {
                    if (!input.value) {
                        isValid = false;
                        input.style.borderColor = '#EF4444';
                    } else {
                        input.style.borderColor = '#E5E7EB';
                    }
                });

                if (!isValid) {
                    alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // ëª¨ë“  ë‹¨ê³„ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.form-card').forEach(card => {
                card.style.display = 'none';
            });

            // ì„ íƒí•œ ë‹¨ê³„ í‘œì‹œ
            document.getElementById('step' + step).style.display = 'block';

            // Step 3ìœ¼ë¡œ ì´ë™ ì‹œ ì„œëª… íŒ¨ë“œ ì´ˆê¸°í™”
            if (step === 3 && !signaturePad) {
                setTimeout(() => {
                    initSignaturePad();
                }, 100);
            }

            // ì§„í–‰ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateProgress(step);

            // ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgress(currentStep) {
            const steps = document.querySelectorAll('.step');
            const progressLine = document.getElementById('progressLine');

            steps.forEach((step, index) => {
                const stepNum = index + 1;
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            // ì§„í–‰ ë°” ë„ˆë¹„ ê³„ì‚°
            const progress = ((currentStep - 1) / (steps.length - 1)) * 100;
            progressLine.style.width = progress + '%';
        }

        // ë„¤ì´ë²„ ì£¼ì†Œ ê²€ìƒ‰ API
        function execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    let addr = '';
                    
                    if (data.userSelectedType === 'R') {
                        addr = data.roadAddress;
                    } else {
                        addr = data.jibunAddress;
                    }

                    document.getElementById('postcode').value = data.zonecode;
                    document.getElementById('address').value = addr;
                    document.querySelector('input[name="detailAddress"]').focus();
                }
            }).open();
        }

        // íŒŒì¼ ë“œë˜ê·¸ & ë“œë¡­
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, inputId) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const input = document.getElementById(inputId);
                input.files = files;
                previewFile(input, inputId + 'Preview');
            }
        }

        // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
        function previewFile(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <div class="remove-btn" onclick="removeFile('${input.id}', '${previewId}')">Ã—</div>
                    `;
                    preview.appendChild(fileItem);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeFile(inputId, previewId) {
            document.getElementById(inputId).value = '';
            document.getElementById(previewId).innerHTML = '';
        }

        // í¼ ì œì¶œ
        document.getElementById('profileForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // ì„œëª… í™•ì¸
            if (signaturePad.isEmpty()) {
                alert('ì „ìì„œëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì €ì¥ ì¤‘...';

            try {
                // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
                const session = await checkSession();
                if (!session || !session.user) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = 'index.html';
                    return;
                }

                // í¼ ë°ì´í„° ìˆ˜ì§‘
                const formData = new FormData(this);
                
                // ì„œëª… ë°ì´í„° ì¶”ê°€
                const signatureData = signaturePad.toDataURL();
                
                // íŒŒì¼ ì—…ë¡œë“œ URL ì €ì¥ ë³€ìˆ˜
                let arcFrontUrl = null;
                let arcBackUrl = null;
                let passportUrl = null;
                let signatureUrl = null;
                
                submitBtn.textContent = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘...';
                
                // ğŸ”„ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
                const userId = session.user.id;
                const timestamp = Date.now();
                
                // ì™¸êµ­ì¸ë“±ë¡ì¦ ì•ë©´ ì—…ë¡œë“œ
                const arcFrontFile = document.getElementById('arcFront').files[0];
                if (arcFrontFile) {
                    const arcFrontPath = `${userId}/arc_front_${timestamp}.${arcFrontFile.name.split('.').pop()}`;
                    const arcFrontResult = await uploadProfileDocument(arcFrontPath, arcFrontFile);
                    if (arcFrontResult.success) {
                        arcFrontUrl = arcFrontResult.data.path;
                        console.log('âœ… ì™¸êµ­ì¸ë“±ë¡ì¦ ì•ë©´ ì—…ë¡œë“œ:', arcFrontUrl);
                    }
                }
                
                // ì™¸êµ­ì¸ë“±ë¡ì¦ ë’·ë©´ ì—…ë¡œë“œ
                const arcBackFile = document.getElementById('arcBack').files[0];
                if (arcBackFile) {
                    const arcBackPath = `${userId}/arc_back_${timestamp}.${arcBackFile.name.split('.').pop()}`;
                    const arcBackResult = await uploadProfileDocument(arcBackPath, arcBackFile);
                    if (arcBackResult.success) {
                        arcBackUrl = arcBackResult.data.path;
                        console.log('âœ… ì™¸êµ­ì¸ë“±ë¡ì¦ ë’·ë©´ ì—…ë¡œë“œ:', arcBackUrl);
                    }
                }
                
                // ì—¬ê¶Œ ì—…ë¡œë“œ
                const passportFile = document.getElementById('passport').files[0];
                if (passportFile) {
                    const passportPath = `${userId}/passport_${timestamp}.${passportFile.name.split('.').pop()}`;
                    const passportResult = await uploadProfileDocument(passportPath, passportFile);
                    if (passportResult.success) {
                        passportUrl = passportResult.data.path;
                        console.log('âœ… ì—¬ê¶Œ ì—…ë¡œë“œ:', passportUrl);
                    }
                }
                
                // ì „ìì„œëª… ì—…ë¡œë“œ (Base64 -> Blob ë³€í™˜)
                if (signatureData) {
                    const signatureBlob = await fetch(signatureData).then(r => r.blob());
                    const signaturePath = `${userId}/signature_${timestamp}.png`;
                    const signatureResult = await uploadProfileDocument(signaturePath, signatureBlob);
                    if (signatureResult.success) {
                        signatureUrl = signatureResult.data.path;
                        console.log('âœ… ì „ìì„œëª… ì—…ë¡œë“œ:', signatureUrl);
                    }
                }
                
                submitBtn.textContent = 'í”„ë¡œí•„ ì €ì¥ ì¤‘...';

                // Supabaseì— ì €ì¥í•  í”„ë¡œí•„ ë°ì´í„°
                const profileData = {
                    name: formData.get('lastName') + formData.get('firstName'),
                    email: session.user.email,
                    phone: formData.get('phone'),
                    nationality: formData.get('nationality'),
                    birth_date: formData.get('birthDate'),
                    gender: formData.get('gender'),
                    passport_number: formData.get('foreignerNumber'),
                    visa_type: formData.get('visaType'),
                    visa_expiry_date: formData.get('stayExpiry'),
                    address: formData.get('address') + ' ' + formData.get('detailAddress') + ' (' + formData.get('postcode') + ')',
                    preferred_messenger: formData.get('preferredMessenger'),
                    messenger_id: formData.get('messengerId'),
                    role: 'customer',
                    // ì²¨ë¶€íŒŒì¼ URL ì¶”ê°€
                    arc_front_url: arcFrontUrl,
                    arc_back_url: arcBackUrl,
                    passport_url: passportUrl,
                    signature_url: signatureUrl
                };

                // Supabaseì— í”„ë¡œí•„ ìƒì„±
                const result = await createUserProfile(session.user.id, profileData);
                
                if (result.success) {
                    console.log('âœ… í”„ë¡œí•„ ìƒì„± ì„±ê³µ:', result.data);
                    
                    // âœ… í”„ë¡œí•„ ìƒì„± ì™„ë£Œ í”Œë˜ê·¸ ì €ì¥ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
                    sessionStorage.setItem('profileCreated', 'true');
                    
                    // âœ… í”„ë¡œí•„ ë°ì´í„°ë¥¼ sessionStorageì— ìºì‹±
                    sessionStorage.setItem('userProfileCache', JSON.stringify(profileData));
                    
                    alert('ê¸°ë³¸ ì‚¬í•­ ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    
                    // âœ… 1ì´ˆ ëŒ€ê¸° í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ (Supabase ë™ê¸°í™” ì‹œê°„)
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    window.location.href = 'index.html';
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('í”„ë¡œí•„ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
        
        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('backButton').addEventListener('click', function() {
            // í”„ë¡œí•„ ì‘ì„±ì„ ê±´ë„ˆë›´ë‹¤ëŠ” í”Œë˜ê·¸ ì„¤ì •
            sessionStorage.setItem('skipProfileSetup', 'true');
            // index í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = 'index.html';
        });
        
        // ë§ˆìš°ìŠ¤ í˜¸ë²„ íš¨ê³¼
        const backBtn = document.getElementById('backButton');
        backBtn.addEventListener('mouseenter', function() {
            this.style.background = 'white';
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
        });
        backBtn.addEventListener('mouseleave', function() {
            this.style.background = 'rgba(255,255,255,0.95)';
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
        });
    </script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js?v=20250108"></script>
</body>
</html>
