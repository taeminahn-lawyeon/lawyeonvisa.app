<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸”ë¡œê·¸ ê¸€ì“°ê¸° | ê´€ë¦¬ì</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            color: #191f28;
            line-height: 1.6;
        }

        /* í—¤ë” */
        .header {
            background: #1a1a2e;
            color: white;
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header h1 {
            font-size: 16px;
            font-weight: 600;
        }

        .header-back {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 14px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn-primary {
            background: #3182f6;
            color: white;
        }

        .btn-primary:hover {
            background: #1b64da;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            min-height: calc(100vh - 60px);
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: -1;
            }
        }

        /* ì—ë””í„° ì˜ì—­ */
        .editor-area {
            padding: 32px;
            max-width: 800px;
        }

        /* ì œëª© ì…ë ¥ */
        .title-input {
            width: 100%;
            font-size: 32px;
            font-weight: 700;
            border: none;
            background: transparent;
            outline: none;
            margin-bottom: 24px;
            color: #191f28;
        }

        .title-input::placeholder {
            color: #adb5bd;
        }

        /* ë¸”ë¡ ì»¨í…Œì´ë„ˆ */
        .blocks-container {
            min-height: 400px;
        }

        /* ë¸”ë¡ */
        .block {
            position: relative;
            background: white;
            border: 2px solid transparent;
            border-radius: 12px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .block:hover {
            border-color: #e5e8eb;
        }

        .block.selected {
            border-color: #3182f6;
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #e5e8eb;
        }

        .block-type {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #6b7684;
        }

        .block-actions {
            display: flex;
            gap: 4px;
        }

        .block-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #8b95a1;
            transition: all 0.2s;
        }

        .block-action-btn:hover {
            background: #e5e8eb;
            color: #191f28;
        }

        .block-content {
            padding: 16px;
        }

        /* ë¸”ë¡ ì…ë ¥ í•„ë“œ */
        .block-input {
            width: 100%;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            padding: 12px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        .block-input:focus {
            border-color: #3182f6;
        }

        .block-input-small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .block-input-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #6b7684;
            margin-bottom: 6px;
        }

        .block-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .block-row > * {
            flex: 1;
        }

        /* ë²ˆí˜¸ ì„¹ì…˜ ë¸”ë¡ */
        .number-input {
            width: 60px;
            text-align: center;
            flex: none !important;
        }

        /* í‘œ ë¸”ë¡ */
        .table-editor {
            overflow-x: auto;
        }

        .table-editor table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-editor th, .table-editor td {
            border: 1px solid #e5e8eb;
            padding: 0;
        }

        .table-editor input {
            width: 100%;
            border: none;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
            outline: none;
        }

        .table-editor th input {
            background: #f8f9fa;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .table-action-btn {
            padding: 6px 12px;
            background: #f8f9fa;
            border: 1px solid #e5e8eb;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .table-action-btn:hover {
            background: #e5e8eb;
        }

        /* ì•ˆë‚´ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì„ íƒ */
        .style-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .style-option {
            padding: 8px 16px;
            border: 2px solid #e5e8eb;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .style-option:hover {
            border-color: #adb5bd;
        }

        .style-option.selected {
            border-color: #3182f6;
            background: #e8f4fd;
        }

        /* ë¸”ë¡ ì¶”ê°€ ë²„íŠ¼ */
        .add-block-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 16px;
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            background: transparent;
            color: #6b7684;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-block-btn:hover {
            border-color: #3182f6;
            color: #3182f6;
            background: #f8f9fa;
        }

        /* ë¸”ë¡ ì¶”ê°€ ë©”ë‰´ */
        .block-menu {
            display: none;
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translateX(-50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            padding: 8px;
            z-index: 50;
            min-width: 280px;
            margin-bottom: 8px;
        }

        .block-menu.show {
            display: block;
        }

        .block-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 14px;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
        }

        .block-menu-item:hover {
            background: #f8f9fa;
        }

        .block-menu-icon {
            width: 36px;
            height: 36px;
            background: #f2f4f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .block-menu-text {
            flex: 1;
        }

        .block-menu-title {
            font-weight: 600;
            color: #191f28;
        }

        .block-menu-desc {
            font-size: 12px;
            color: #8b95a1;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            background: white;
            border-left: 1px solid #e5e8eb;
            padding: 24px;
        }

        .sidebar-section {
            margin-bottom: 32px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 16px;
        }

        .sidebar-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #6b7684;
            margin-bottom: 8px;
        }

        .sidebar-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            margin-bottom: 16px;
            outline: none;
        }

        .sidebar-input:focus {
            border-color: #3182f6;
        }

        .sidebar-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            margin-bottom: 16px;
            outline: none;
            background: white;
        }

        /* ì¸ë„¤ì¼ ì—…ë¡œë“œ */
        .thumbnail-upload {
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .thumbnail-upload:hover {
            border-color: #3182f6;
            background: #f8f9fa;
        }

        .thumbnail-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .thumbnail-upload-text {
            font-size: 14px;
            color: #6b7684;
        }

        .thumbnail-preview {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        /* ê´€ë ¨ ì„œë¹„ìŠ¤ */
        .service-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .service-checkbox:hover {
            background: #f8f9fa;
        }

        .service-checkbox.checked {
            border-color: #3182f6;
            background: #e8f4fd;
        }

        .service-checkbox input {
            display: none;
        }

        .service-checkbox-mark {
            width: 20px;
            height: 20px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .service-checkbox.checked .service-checkbox-mark {
            background: #3182f6;
            border-color: #3182f6;
            color: white;
        }

        .service-checkbox-label {
            font-size: 14px;
            color: #333d4b;
        }

        /* ë°œí–‰ ìƒíƒœ í† ê¸€ */
        .publish-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .publish-toggle-label {
            font-size: 14px;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: #dee2e6;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.active {
            background: #3182f6;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.2s;
        }

        .toggle-switch.active::after {
            left: 25px;
        }

        /* ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            overflow-y: auto;
        }

        .preview-modal.show {
            display: block;
        }

        .preview-content {
            background: white;
            max-width: 800px;
            margin: 40px auto;
            border-radius: 16px;
            overflow: hidden;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e8eb;
        }

        .preview-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            font-size: 20px;
            cursor: pointer;
        }

        .preview-body {
            padding: 40px;
        }

        /* ë¡œë”© */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 300;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e8eb;
            border-top-color: #3182f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-box {
            background: white;
            padding: 48px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-box h2 {
            font-size: 24px;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 8px;
            text-align: center;
        }

        .login-box p {
            font-size: 14px;
            color: #6b7684;
            margin-bottom: 32px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e5e8eb;
            border-radius: 10px;
            font-size: 15px;
            margin-bottom: 12px;
            outline: none;
            transition: border-color 0.2s;
        }

        .login-input:focus {
            border-color: #3182f6;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3182f6, #1b64da);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(49,130,246,0.3);
        }

        .login-error {
            color: #f03e3e;
            font-size: 14px;
            text-align: center;
            margin-top: 16px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <h2>ë¸”ë¡œê·¸ ê´€ë¦¬ì</h2>
            <p>ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”</p>
            <form id="blogLoginForm">
                <input type="text" class="login-input" id="blogAdminId" placeholder="ì•„ì´ë””" required>
                <input type="password" class="login-input" id="blogAdminPw" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
            </form>
            <div class="login-error" id="loginError">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <header class="header">
        <div class="header-left">
            <a href="admin-blog.html" class="header-back">â† ëª©ë¡</a>
            <h1>ë¸”ë¡œê·¸ ê¸€ì“°ê¸°</h1>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="showPreview()">ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn btn-primary" onclick="savePost()">ì €ì¥</button>
        </div>
    </header>

    <main class="main-layout">
        <div class="editor-area">
            <input type="text" class="title-input" id="postTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">

            <div class="blocks-container" id="blocksContainer">
                <!-- ë¸”ë¡ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
            </div>

            <div style="position: relative;">
                <button class="add-block-btn" onclick="toggleBlockMenu()">
                    <span>+</span>
                    <span>ë¸”ë¡ ì¶”ê°€</span>
                </button>
                <div class="block-menu" id="blockMenu">
                    <button class="block-menu-item" onclick="addBlock('paragraph')">
                        <div class="block-menu-icon">ğŸ“</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">í…ìŠ¤íŠ¸</div>
                            <div class="block-menu-desc">ì¼ë°˜ í…ìŠ¤íŠ¸ ë‹¨ë½</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('heading')">
                        <div class="block-menu-icon">H</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">ì œëª©</div>
                            <div class="block-menu-desc">ì„¹ì…˜ ì œëª© (ëª©ì°¨ì— í‘œì‹œë¨)</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('numbered-section')">
                        <div class="block-menu-icon">1ï¸âƒ£</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">ë²ˆí˜¸ ì„¹ì…˜</div>
                            <div class="block-menu-desc">ë²ˆí˜¸ê°€ ìˆëŠ” ê°•ì¡° ì„¹ì…˜</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('table')">
                        <div class="block-menu-icon">ğŸ“Š</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">í‘œ</div>
                            <div class="block-menu-desc">ë°ì´í„° í‘œ ì‚½ì…</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('info-box')">
                        <div class="block-menu-icon">ğŸ’¡</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">ì•ˆë‚´ ë°•ìŠ¤</div>
                            <div class="block-menu-desc">ì •ë³´, ì£¼ì˜, ê²½ê³  ì•ˆë‚´</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('list')">
                        <div class="block-menu-icon">â€¢</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">ëª©ë¡</div>
                            <div class="block-menu-desc">ê¸€ë¨¸ë¦¬ ê¸°í˜¸ ë˜ëŠ” ë²ˆí˜¸ ëª©ë¡</div>
                        </div>
                    </button>
                    <button class="block-menu-item" onclick="addBlock('link-button')">
                        <div class="block-menu-icon">ğŸ”—</div>
                        <div class="block-menu-text">
                            <div class="block-menu-title">ë§í¬ ë²„íŠ¼</div>
                            <div class="block-menu-desc">ì™¸ë¶€ ë§í¬ ë²„íŠ¼</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">ë°œí–‰ ì„¤ì •</div>
                <div class="publish-toggle">
                    <span class="publish-toggle-label">ë°œí–‰ ìƒíƒœ</span>
                    <div class="toggle-switch" id="publishToggle" onclick="togglePublish()"></div>
                </div>
                <span id="publishStatus" style="font-size: 13px; color: #8b95a1;">ì„ì‹œì €ì¥</span>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">ê¸€ ì •ë³´</div>
                <label class="sidebar-label">ì¹´í…Œê³ ë¦¬</label>
                <select class="sidebar-select" id="postCategory">
                    <option value="citizenship">êµ­ì Â·ê·€í™”Â·ë‚œë¯¼</option>
                    <option value="admin">ê³µí†µ í–‰ì • ì‹ ê³ </option>
                    <option value="work">ì·¨ì—…Â·ì›Œí¬</option>
                    <option value="education">êµìœ¡Â·êµ¬ì§</option>
                    <option value="business">ì‚¬ì—…Â·íˆ¬ì</option>
                    <option value="family">ë™í¬Â·ê°€ì¡±Â·ê²°í˜¼</option>
                    <option value="residence">ê±°ì£¼Â·ì˜ì£¼</option>
                </select>

                <label class="sidebar-label">URL ìŠ¬ëŸ¬ê·¸</label>
                <input type="text" class="sidebar-input" id="postSlug" placeholder="url-slug">

                <label class="sidebar-label">ìš”ì•½ (ëª©ë¡ì— í‘œì‹œ)</label>
                <textarea class="sidebar-input" id="postExcerpt" rows="3" placeholder="ê¸€ ìš”ì•½ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">ì¸ë„¤ì¼</div>
                <div class="thumbnail-upload" id="thumbnailUpload" onclick="document.getElementById('thumbnailInput').click()">
                    <div class="thumbnail-upload-icon">ğŸ“·</div>
                    <div class="thumbnail-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <input type="file" id="thumbnailInput" accept="image/*" style="display: none;" onchange="uploadThumbnail(event)">
                <img id="thumbnailPreview" class="thumbnail-preview" style="display: none;">
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">ê´€ë ¨ ì„œë¹„ìŠ¤ (CTA)</div>
                <div id="servicesList">
                    <label class="service-checkbox" onclick="toggleService(this, 'visa-e9')">
                        <div class="service-checkbox-mark">âœ“</div>
                        <span class="service-checkbox-label">E-9 ë¹„ì ì‹ ì²­</span>
                    </label>
                    <label class="service-checkbox" onclick="toggleService(this, 'visa-d10')">
                        <div class="service-checkbox-mark">âœ“</div>
                        <span class="service-checkbox-label">D-10 ë¹„ì ì—°ì¥</span>
                    </label>
                    <label class="service-checkbox" onclick="toggleService(this, 'stay-extension')">
                        <div class="service-checkbox-mark">âœ“</div>
                        <span class="service-checkbox-label">ì²´ë¥˜ê¸°ê°„ ì—°ì¥</span>
                    </label>
                    <label class="service-checkbox" onclick="toggleService(this, 'visa-prediagnosis')">
                        <div class="service-checkbox-mark">âœ“</div>
                        <span class="service-checkbox-label">ë¹„ì ì‚¬ì „ì§„ë‹¨</span>
                    </label>
                </div>
            </div>
        </aside>
    </main>

    <!-- ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-content">
            <div class="preview-header">
                <span>ë¯¸ë¦¬ë³´ê¸°</span>
                <button class="preview-close" onclick="closePreview()">Ã—</button>
            </div>
            <div class="preview-body" id="previewBody"></div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <span>ì €ì¥ ì¤‘...</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ë¸”ë¡œê·¸ ê´€ë¦¬ì ê³„ì •
        const BLOG_ADMIN_ID = 'admin012';
        const BLOG_ADMIN_PW = 'lawyeon2601';

        // ê´€ë¦¬ì ì¸ì¦ ì²´í¬ ë° ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
        (function() {
            const isLoggedIn = sessionStorage.getItem('blogAdminLoggedIn') === 'true';
            const loginOverlay = document.getElementById('loginOverlay');

            if (isLoggedIn) {
                loginOverlay.classList.add('hidden');
            }

            // ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
            document.getElementById('blogLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const inputId = document.getElementById('blogAdminId').value.trim();
                const inputPw = document.getElementById('blogAdminPw').value;
                const errorMsg = document.getElementById('loginError');

                if (inputId === BLOG_ADMIN_ID && inputPw === BLOG_ADMIN_PW) {
                    sessionStorage.setItem('blogAdminLoggedIn', 'true');
                    loginOverlay.classList.add('hidden');
                    errorMsg.style.display = 'none';
                } else {
                    errorMsg.style.display = 'block';
                }
            });
        })();

        // Supabase ì´ˆê¸°í™”
        const SUPABASE_URL = 'https://gqistzsergddnpcvuzba.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdxaXN0enNlcmdkZG5wY3Z1emJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNTEyMjEsImV4cCI6MjA4MDcyNzIyMX0.X_GgShObq9OJ6z7aEKdUCoyHYo-OJL-I5hcIDt4komg';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ìƒíƒœ
        let blocks = [];
        let isPublished = false;
        let postId = null;
        let thumbnailUrl = null;
        let selectedServices = [];

        // URLì—ì„œ ID ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì • ëª¨ë“œ)
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get('id');

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            if (editId) {
                loadPost(editId);
            }
        });

        // ê¸°ì¡´ ê¸€ ë¡œë“œ
        async function loadPost(id) {
            try {
                const { data: post, error } = await supabase
                    .from('blog_posts')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) throw error;

                postId = post.id;
                document.getElementById('postTitle').value = post.title;
                document.getElementById('postCategory').value = post.category;
                document.getElementById('postSlug').value = post.slug;
                document.getElementById('postExcerpt').value = post.excerpt || '';
                isPublished = post.is_published;
                thumbnailUrl = post.thumbnail_url;

                if (isPublished) {
                    document.getElementById('publishToggle').classList.add('active');
                    document.getElementById('publishStatus').textContent = 'ë°œí–‰ë¨';
                }

                if (thumbnailUrl) {
                    document.getElementById('thumbnailPreview').src = thumbnailUrl;
                    document.getElementById('thumbnailPreview').style.display = 'block';
                    document.getElementById('thumbnailUpload').style.display = 'none';
                }

                // ì½˜í…ì¸  ë¡œë“œ
                try {
                    blocks = JSON.parse(post.content);
                } catch {
                    blocks = [{ type: 'paragraph', content: post.content }];
                }

                // ê´€ë ¨ ì„œë¹„ìŠ¤ ë¡œë“œ
                if (post.related_services) {
                    selectedServices = JSON.parse(post.related_services);
                    selectedServices.forEach(s => {
                        const checkbox = document.querySelector(`[onclick*="${s.id}"]`);
                        if (checkbox) checkbox.classList.add('checked');
                    });
                }

                renderBlocks();

            } catch (error) {
                console.error('Error loading post:', error);
                alert('ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¸”ë¡ ë©”ë‰´ í† ê¸€
        function toggleBlockMenu() {
            document.getElementById('blockMenu').classList.toggle('show');
        }

        // ë¸”ë¡ ì¶”ê°€
        function addBlock(type) {
            const block = createBlockData(type);
            blocks.push(block);
            renderBlocks();
            toggleBlockMenu();
        }

        // ë¸”ë¡ ë°ì´í„° ìƒì„±
        function createBlockData(type) {
            switch (type) {
                case 'paragraph':
                    return { type: 'paragraph', content: '' };
                case 'heading':
                    return { type: 'heading', content: '' };
                case 'numbered-section':
                    return { type: 'numbered-section', number: blocks.filter(b => b.type === 'numbered-section').length + 1, title: '', content: '' };
                case 'table':
                    return { type: 'table', headers: ['í•­ëª©', 'ë‚´ìš©'], rows: [['', '']] };
                case 'info-box':
                    return { type: 'info-box', style: 'info', content: '' };
                case 'list':
                    return { type: 'list', ordered: false, items: [''] };
                case 'link-button':
                    return { type: 'link-button', text: '', url: '' };
                default:
                    return { type: 'paragraph', content: '' };
            }
        }

        // ë¸”ë¡ ë Œë”ë§
        function renderBlocks() {
            const container = document.getElementById('blocksContainer');
            container.innerHTML = blocks.map((block, index) => renderBlockEditor(block, index)).join('');
        }

        // ë¸”ë¡ ì—ë””í„° ë Œë”ë§
        function renderBlockEditor(block, index) {
            const typeLabels = {
                'paragraph': 'ğŸ“ í…ìŠ¤íŠ¸',
                'heading': 'H ì œëª©',
                'numbered-section': '1ï¸âƒ£ ë²ˆí˜¸ ì„¹ì…˜',
                'table': 'ğŸ“Š í‘œ',
                'info-box': 'ğŸ’¡ ì•ˆë‚´ ë°•ìŠ¤',
                'list': 'â€¢ ëª©ë¡',
                'link-button': 'ğŸ”— ë§í¬ ë²„íŠ¼'
            };

            return `
                <div class="block" data-index="${index}">
                    <div class="block-header">
                        <span class="block-type">${typeLabels[block.type]}</span>
                        <div class="block-actions">
                            ${index > 0 ? `<button class="block-action-btn" onclick="moveBlock(${index}, -1)">â†‘</button>` : ''}
                            ${index < blocks.length - 1 ? `<button class="block-action-btn" onclick="moveBlock(${index}, 1)">â†“</button>` : ''}
                            <button class="block-action-btn" onclick="deleteBlock(${index})">ğŸ—‘</button>
                        </div>
                    </div>
                    <div class="block-content">
                        ${renderBlockContent(block, index)}
                    </div>
                </div>
            `;
        }

        // ë¸”ë¡ ë‚´ìš© ë Œë”ë§
        function renderBlockContent(block, index) {
            switch (block.type) {
                case 'paragraph':
                    return `<textarea class="block-input" rows="3" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onchange="updateBlock(${index}, 'content', this.value)">${block.content}</textarea>`;

                case 'heading':
                    return `<input type="text" class="block-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" value="${block.content}" onchange="updateBlock(${index}, 'content', this.value)">`;

                case 'numbered-section':
                    return `
                        <div class="block-row">
                            <div>
                                <label class="block-input-label">ë²ˆí˜¸</label>
                                <input type="number" class="block-input block-input-small number-input" value="${block.number}" onchange="updateBlock(${index}, 'number', parseInt(this.value))">
                            </div>
                            <div style="flex: 4;">
                                <label class="block-input-label">ì œëª©</label>
                                <input type="text" class="block-input block-input-small" placeholder="ì„¹ì…˜ ì œëª©" value="${block.title}" onchange="updateBlock(${index}, 'title', this.value)">
                            </div>
                        </div>
                        <label class="block-input-label">ë‚´ìš©</label>
                        <textarea class="block-input" rows="3" placeholder="ì„¹ì…˜ ë‚´ìš©" onchange="updateBlock(${index}, 'content', this.value)">${block.content}</textarea>
                    `;

                case 'table':
                    return `
                        <div class="table-editor">
                            <table>
                                <thead>
                                    <tr>
                                        ${block.headers.map((h, hi) => `<th><input type="text" value="${h}" onchange="updateTableHeader(${index}, ${hi}, this.value)"></th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${block.rows.map((row, ri) => `
                                        <tr>
                                            ${row.map((cell, ci) => `<td><input type="text" value="${cell}" onchange="updateTableCell(${index}, ${ri}, ${ci}, this.value)"></td>`).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="table-actions">
                            <button class="table-action-btn" onclick="addTableRow(${index})">+ í–‰ ì¶”ê°€</button>
                            <button class="table-action-btn" onclick="addTableColumn(${index})">+ ì—´ ì¶”ê°€</button>
                            <button class="table-action-btn" onclick="removeTableRow(${index})">- í–‰ ì‚­ì œ</button>
                            <button class="table-action-btn" onclick="removeTableColumn(${index})">- ì—´ ì‚­ì œ</button>
                        </div>
                    `;

                case 'info-box':
                    return `
                        <div class="style-selector">
                            <div class="style-option ${block.style === 'info' ? 'selected' : ''}" onclick="updateBlock(${index}, 'style', 'info'); renderBlocks();">â„¹ï¸ ì •ë³´</div>
                            <div class="style-option ${block.style === 'warning' ? 'selected' : ''}" onclick="updateBlock(${index}, 'style', 'warning'); renderBlocks();">âš ï¸ ì£¼ì˜</div>
                            <div class="style-option ${block.style === 'danger' ? 'selected' : ''}" onclick="updateBlock(${index}, 'style', 'danger'); renderBlocks();">ğŸš¨ ê²½ê³ </div>
                            <div class="style-option ${block.style === 'success' ? 'selected' : ''}" onclick="updateBlock(${index}, 'style', 'success'); renderBlocks();">âœ… ì„±ê³µ</div>
                        </div>
                        <textarea class="block-input" rows="2" placeholder="ì•ˆë‚´ ë‚´ìš©" onchange="updateBlock(${index}, 'content', this.value)">${block.content}</textarea>
                    `;

                case 'list':
                    return `
                        <div class="style-selector">
                            <div class="style-option ${!block.ordered ? 'selected' : ''}" onclick="updateBlock(${index}, 'ordered', false); renderBlocks();">â€¢ ê¸€ë¨¸ë¦¬</div>
                            <div class="style-option ${block.ordered ? 'selected' : ''}" onclick="updateBlock(${index}, 'ordered', true); renderBlocks();">1. ë²ˆí˜¸</div>
                        </div>
                        ${block.items.map((item, ii) => `
                            <div class="block-row" style="margin-bottom: 8px;">
                                <input type="text" class="block-input block-input-small" value="${item}" onchange="updateListItem(${index}, ${ii}, this.value)" placeholder="í•­ëª© ${ii + 1}">
                                ${block.items.length > 1 ? `<button class="table-action-btn" style="flex: none; width: 36px;" onclick="removeListItem(${index}, ${ii})">Ã—</button>` : ''}
                            </div>
                        `).join('')}
                        <button class="table-action-btn" onclick="addListItem(${index})">+ í•­ëª© ì¶”ê°€</button>
                    `;

                case 'link-button':
                    return `
                        <div class="block-row">
                            <div>
                                <label class="block-input-label">ë²„íŠ¼ í…ìŠ¤íŠ¸</label>
                                <input type="text" class="block-input block-input-small" placeholder="ë°”ë¡œê°€ê¸°" value="${block.text}" onchange="updateBlock(${index}, 'text', this.value)">
                            </div>
                            <div>
                                <label class="block-input-label">URL</label>
                                <input type="url" class="block-input block-input-small" placeholder="https://..." value="${block.url}" onchange="updateBlock(${index}, 'url', this.value)">
                            </div>
                        </div>
                    `;

                default:
                    return '';
            }
        }

        // ë¸”ë¡ ì—…ë°ì´íŠ¸
        function updateBlock(index, key, value) {
            blocks[index][key] = value;
        }

        // ë¸”ë¡ ì´ë™
        function moveBlock(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < blocks.length) {
                [blocks[index], blocks[newIndex]] = [blocks[newIndex], blocks[index]];
                renderBlocks();
            }
        }

        // ë¸”ë¡ ì‚­ì œ
        function deleteBlock(index) {
            if (confirm('ì´ ë¸”ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                blocks.splice(index, 1);
                renderBlocks();
            }
        }

        // í‘œ ê´€ë ¨ í•¨ìˆ˜
        function updateTableHeader(blockIndex, headerIndex, value) {
            blocks[blockIndex].headers[headerIndex] = value;
        }

        function updateTableCell(blockIndex, rowIndex, cellIndex, value) {
            blocks[blockIndex].rows[rowIndex][cellIndex] = value;
        }

        function addTableRow(blockIndex) {
            const cols = blocks[blockIndex].headers.length;
            blocks[blockIndex].rows.push(Array(cols).fill(''));
            renderBlocks();
        }

        function addTableColumn(blockIndex) {
            blocks[blockIndex].headers.push('');
            blocks[blockIndex].rows.forEach(row => row.push(''));
            renderBlocks();
        }

        function removeTableRow(blockIndex) {
            if (blocks[blockIndex].rows.length > 1) {
                blocks[blockIndex].rows.pop();
                renderBlocks();
            }
        }

        function removeTableColumn(blockIndex) {
            if (blocks[blockIndex].headers.length > 1) {
                blocks[blockIndex].headers.pop();
                blocks[blockIndex].rows.forEach(row => row.pop());
                renderBlocks();
            }
        }

        // ëª©ë¡ ê´€ë ¨ í•¨ìˆ˜
        function updateListItem(blockIndex, itemIndex, value) {
            blocks[blockIndex].items[itemIndex] = value;
        }

        function addListItem(blockIndex) {
            blocks[blockIndex].items.push('');
            renderBlocks();
        }

        function removeListItem(blockIndex, itemIndex) {
            blocks[blockIndex].items.splice(itemIndex, 1);
            renderBlocks();
        }

        // ë°œí–‰ í† ê¸€
        function togglePublish() {
            isPublished = !isPublished;
            document.getElementById('publishToggle').classList.toggle('active');
            document.getElementById('publishStatus').textContent = isPublished ? 'ë°œí–‰ë¨' : 'ì„ì‹œì €ì¥';
        }

        // ì„œë¹„ìŠ¤ í† ê¸€
        function toggleService(el, serviceId) {
            el.classList.toggle('checked');
            const serviceName = el.querySelector('.service-checkbox-label').textContent;

            const index = selectedServices.findIndex(s => s.id === serviceId);
            if (index > -1) {
                selectedServices.splice(index, 1);
            } else {
                selectedServices.push({ id: serviceId, name: serviceName });
            }
        }

        // ì¸ë„¤ì¼ ì—…ë¡œë“œ
        async function uploadThumbnail(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}.${fileExt}`;
                const filePath = `blog-thumbnails/${fileName}`;

                const { data, error } = await supabase.storage
                    .from('blog')
                    .upload(filePath, file);

                if (error) throw error;

                const { data: { publicUrl } } = supabase.storage
                    .from('blog')
                    .getPublicUrl(filePath);

                thumbnailUrl = publicUrl;
                document.getElementById('thumbnailPreview').src = publicUrl;
                document.getElementById('thumbnailPreview').style.display = 'block';
                document.getElementById('thumbnailUpload').style.display = 'none';

            } catch (error) {
                console.error('Error uploading thumbnail:', error);
                alert('ì¸ë„¤ì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¯¸ë¦¬ë³´ê¸°
        function showPreview() {
            const title = document.getElementById('postTitle').value;
            const category = document.getElementById('postCategory').value;

            const categoryNames = { 'citizenship': 'êµ­ì Â·ê·€í™”Â·ë‚œë¯¼', 'admin': 'ê³µí†µ í–‰ì • ì‹ ê³ ', 'work': 'ì·¨ì—…Â·ì›Œí¬', 'education': 'êµìœ¡Â·êµ¬ì§', 'business': 'ì‚¬ì—…Â·íˆ¬ì', 'family': 'ë™í¬Â·ê°€ì¡±Â·ê²°í˜¼', 'residence': 'ê±°ì£¼Â·ì˜ì£¼' };

            const previewHtml = `
                <span style="display: inline-block; padding: 6px 12px; background: #f2f4f6; border-radius: 6px; font-size: 13px; font-weight: 600; color: #3182f6; margin-bottom: 16px;">${categoryNames[category]}</span>
                <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 32px;">${title || 'ì œëª© ì—†ìŒ'}</h1>
                <div style="font-size: 16px; line-height: 1.8;">
                    ${renderPreviewContent()}
                </div>
            `;

            document.getElementById('previewBody').innerHTML = previewHtml;
            document.getElementById('previewModal').classList.add('show');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('show');
        }

        // ë¯¸ë¦¬ë³´ê¸° ì½˜í…ì¸  ë Œë”ë§
        function renderPreviewContent() {
            return blocks.map(block => {
                switch (block.type) {
                    case 'paragraph':
                        return `<p style="margin-bottom: 20px;">${block.content}</p>`;
                    case 'heading':
                        return `<h2 style="font-size: 22px; font-weight: 700; margin: 40px 0 16px;">${block.content}</h2>`;
                    case 'numbered-section':
                        return `
                            <div style="display: flex; gap: 16px; margin: 24px 0; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                                <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #3182f6, #1b64da); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">${block.number}</div>
                                <div>
                                    <div style="font-size: 17px; font-weight: 700; margin-bottom: 6px;">${block.title}</div>
                                    <div style="color: #4e5968; font-size: 15px;">${block.content}</div>
                                </div>
                            </div>
                        `;
                    case 'table':
                        return `
                            <div style="margin: 24px 0; overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr>${block.headers.map(h => `<th style="background: #1a1a2e; color: white; padding: 12px 16px; text-align: left;">${h}</th>`).join('')}</tr>
                                    </thead>
                                    <tbody>
                                        ${block.rows.map((row, i) => `
                                            <tr style="background: ${i % 2 ? '#f8f9fa' : 'white'};">
                                                ${row.map(cell => `<td style="padding: 12px 16px; border-bottom: 1px solid #e5e8eb;">${cell}</td>`).join('')}
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    case 'info-box':
                        const colors = { info: '#e8f4fd', warning: '#fff8e6', danger: '#ffeaea', success: '#e6fcf5' };
                        const borders = { info: '#3182f6', warning: '#f59f00', danger: '#f03e3e', success: '#20c997' };
                        const icons = { info: 'â„¹ï¸', warning: 'âš ï¸', danger: 'ğŸš¨', success: 'âœ…' };
                        return `
                            <div style="margin: 20px 0; padding: 16px 20px; background: ${colors[block.style]}; border-left: 4px solid ${borders[block.style]}; border-radius: 8px; display: flex; gap: 10px;">
                                <span>${icons[block.style]}</span>
                                <span style="font-size: 15px;">${block.content}</span>
                            </div>
                        `;
                    case 'list':
                        const tag = block.ordered ? 'ol' : 'ul';
                        return `<${tag} style="margin: 16px 0 20px 24px;">${block.items.map(item => `<li style="margin-bottom: 6px;">${item}</li>`).join('')}</${tag}>`;
                    case 'link-button':
                        return `<a href="${block.url}" target="_blank" style="display: inline-block; padding: 12px 24px; background: #3182f6; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; margin: 16px 0;">${block.text} â†’</a>`;
                    default:
                        return '';
                }
            }).join('');
        }

        // ì €ì¥
        async function savePost() {
            const title = document.getElementById('postTitle').value.trim();
            const category = document.getElementById('postCategory').value;
            let slug = document.getElementById('postSlug').value.trim();
            const excerpt = document.getElementById('postExcerpt').value.trim();

            if (!title) {
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // slug ìë™ ìƒì„±
            if (!slug) {
                slug = title
                    .toLowerCase()
                    .replace(/[^a-z0-9ê°€-í£]/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '')
                    + '-' + Date.now();
            }

            document.getElementById('loadingOverlay').classList.add('show');

            try {
                const postData = {
                    title,
                    slug,
                    category,
                    excerpt,
                    content: JSON.stringify(blocks),
                    thumbnail_url: thumbnailUrl,
                    related_services: JSON.stringify(selectedServices),
                    is_published: isPublished,
                    updated_at: new Date().toISOString()
                };

                let result;
                if (postId) {
                    // ìˆ˜ì •
                    result = await supabase
                        .from('blog_posts')
                        .update(postData)
                        .eq('id', postId);
                } else {
                    // ìƒˆ ê¸€
                    postData.created_at = new Date().toISOString();
                    result = await supabase
                        .from('blog_posts')
                        .insert(postData)
                        .select();

                    if (result.data && result.data[0]) {
                        postId = result.data[0].id;
                    }
                }

                if (result.error) throw result.error;

                alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');

            } catch (error) {
                console.error('Error saving post:', error);
                alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').classList.remove('show');
            }
        }

        // ë¸”ë¡ ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('blockMenu');
            const btn = document.querySelector('.add-block-btn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.remove('show');
            }
        });
    </script>
</body>
</html>
